version: '3.8'

services:
  mining-client-cpu-haskell:
    image: ${HASKELL_IMAGE:-salamaashoush/chainweb-mining-client:latest}
    container_name: mining-client-cpu-haskell
    command:
      - --worker
      - cpu
      - --node
      - chainweb-pow:1848
      - --public-key
      - ${MINER_PUBLIC_KEY:-f89ef46927f506c70b6a58fd322450a936311dc6ac91f4ec3d8ef949608dbf1f}
      - --account
      - ${MINER_ACCOUNT:-k:f89ef46927f506c70b6a58fd322450a936311dc6ac91f4ec3d8ef949608dbf1f}
      - --thread-count
      - "2"
      - --log-level
      - info
    depends_on:
      chainweb-pow:
        condition: service_healthy
    networks:
      - chainweb-test
    volumes:
      - test-results:/results
    environment:
      - TEST_MODE=cpu
      - IMPLEMENTATION=haskell

  mining-client-cpu-rust:
    image: ${RUST_IMAGE:-salamaashoush/chainweb-mining-client-rs:latest}
    container_name: mining-client-cpu-rust
    command:
      - --worker
      - cpu
      - --node
      - chainweb-pow:1848
      - --public-key
      - ${MINER_PUBLIC_KEY:-f89ef46927f506c70b6a58fd322450a936311dc6ac91f4ec3d8ef949608dbf1f}
      - --account
      - ${MINER_ACCOUNT:-k:f89ef46927f506c70b6a58fd322450a936311dc6ac91f4ec3d8ef949608dbf1f}
      - --thread-count
      - "2"
      - --log-level
      - info
    depends_on:
      chainweb-pow:
        condition: service_healthy
    networks:
      - chainweb-test
    volumes:
      - test-results:/results
    environment:
      - TEST_MODE=cpu
      - IMPLEMENTATION=rust